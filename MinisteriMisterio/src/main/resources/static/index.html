<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ministerio de Magia - Control Batch</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="main-container">
    <header>
        <h1>üîÆ Ministerio de Magia</h1>
        <p>Departamento de Misterios - Sistema de Procesamiento de Artefactos</p>
    </header>

    <section class="control-panel">
        <div class="card">
            <h2>‚ö° Ejecuci√≥n de Procesos</h2>
            <p>Inicie el procesamiento masivo de artefactos detectados.</p>
            <button id="btnImportar" onclick="iniciarJob()">Importar Artefactos (Batch)</button>
            <div id="resultado" class="status-box hidden"></div>
        </div>

        <div class="card links-card">
            <h2>üõ†Ô∏è Herramientas Administrativas</h2>
            <div class="button-group">
                <a href="/h2-console" target="_blank" class="secondary-btn">üóÑÔ∏è Base de Datos (H2)</a>
                <a href="/actuator/health" target="_blank" class="secondary-btn">‚ù§Ô∏è Estado del Sistema</a>
                <a href="/actuator/batch/jobs" target="_blank" class="secondary-btn">üìä Historial de Jobs</a>
            </div>
        </div>
    </section>

    <footer>
        <p>Sistema desarrollado por: Luis S., Pablo L. y Jiachen Y.</p>
    </footer>
</div>

<script>
    async function iniciarJob() {
        const btn = document.getElementById('btnImportar');
        const res = document.getElementById('resultado');

        // Estado visual de carga
        btn.disabled = true;
        btn.textContent = "‚ú® Conjurando Job...";
        res.className = "status-box processing";
        res.textContent = "‚è≥ Enviando solicitud al servidor...";
        res.classList.remove('hidden');

        try {
            // Llamada al endpoint que creaste en JobController
            const response = await fetch('/job/importar', { method: 'POST' });
            const text = await response.text();

            if (response.ok) {
                res.className = "status-box success";
                res.textContent = "‚úÖ " + text;
            } else {
                res.className = "status-box error";
                res.textContent = "‚ùå Error: " + text;
            }
        } catch (error) {
            res.className = "status-box error";
            res.textContent = "‚ò†Ô∏è Error de conexi√≥n: " + error.message;
        } finally {
            btn.disabled = false;
            btn.textContent = "Importar Artefactos (Batch)";
        }
    }
</script>
</body>
</html>